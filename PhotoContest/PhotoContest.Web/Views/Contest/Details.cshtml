@model PhotoContest.Web.ViewModels.ContestDetailsViewModel
@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "Contest Details";
}


@*new version*@


<h2>@ViewBag.Title</h2>

<div>
    <h3>Contest Status : @Model.Flag</h3>
</div>

@if (Model.Flag == PhotoContest.Models.Flag.Inactive && Model.CreatorName == this.User.Identity.Name)
{
    <div>
        <p>To activate the Contest you have to add Prizes for every Winner!</p>
    </div>
}

@if (Model.CreatorName == this.User.Identity.Name)
{
    if (this.ViewBag.NumOfPrizesInDB != null)
    {
        if (Model.NumberOfPrizes != this.ViewBag.NumOfPrizesInDB)
        {
            @Html.ActionLink("Activate", "CreatePrizes", "Contest"
            , new
            {
                contestId = Model.Id,
                numOfWinnersRequired = this.ViewBag.NumOfWinners,
                leftForAdding = this.ViewBag.NumOfWinners
            },
            new { @class = "btn btn-default" })
        }
    }
}

<div>
    <p>@Html.LabelFor(m => m.Name) : @Model.Name</p>
    <p>@Html.LabelFor(m => m.CategoryName) : @Model.CategoryName</p>
    <p>@Html.LabelFor(m => m.CreatorName) : @Model.CreatorName</p>
    <p>@Html.LabelFor(m => m.Flag) : @Model.Flag</p>
    <p>@Html.LabelFor(m => m.ParticipatingImages) : @Model.ParticipatingImages</p>
    <p>@Html.LabelFor(m => m.Participants) : @Model.Participants</p>
</div>

<div>
    @if (Model.ParticipatingUsers.Contains(this.User.Identity.GetUserId()) || Model.ParticipationStrategy == "Open")
    {
        using (Ajax.BeginForm("UploadImage", "Contest", new { contestId = Model.Id }, new AjaxOptions()
           {
               HttpMethod = "POST",
               InsertionMode = InsertionMode.InsertAfter,
               UpdateTargetId = "images"
           },
           new { @class = "btn btn-default", enctype = "multipart/form-data" }))
        {
            @Html.AntiForgeryToken()
            <input type="file" name="upload" value="" />
            <input type="text" name="title" value="" />
            <input type="text" name="description" value="" />
            <input type="submit" name="name" value="Upload Image" />
        }
    }
    else if (Model.ParticipationStrategy == "Closed" && this.Request.IsAuthenticated)
    {
        using (Ajax.BeginForm("Participate", "Contest", new { contestId = Model.Id }, new AjaxOptions()
           {
               HttpMethod = "POST"
           },
           new { @class = "btn btn-default" }))
        {
            @Html.AntiForgeryToken()
            <input type="submit" name="name" value="Apply for contest" class="btn btn-default" />
        }
    }
</div>

<div>
    <div id="images">
        @if (Model.Images.Any())
        {
            @Html.DisplayFor(i => i.Images)
        }
        else
        {
            <span>The are no images for this contest at the moment.KUF</span>
        }
    </div>
</div>

